#!/bin/sh

if [ "$1" == "" ]; then
	echo 'Usage:'
	echo '  git install-hooks <git-project> [<other project> ...]'
	echo '  git install-hooks --init'
	exit 1
fi

script_location=$(dirname "$0")

is_init=false

for var in "$@"
do
	if [ "$var" == "--init" ]; then
		is_init=true
	fi
done

hooks_path="$script_location"/git-templates/hooks

if [ $is_init == "true" ]; then
	git config --global core.hooksPath "$hooks_path"

	exit 0
fi

for target_repo in "$@"
do
	pushd "$target_repo" &> /dev/null

	existing_hooks_path=$(git config core.hooksPath)
	if [ "$existing_hooks_path" != "" ] && [ "$existing_hooks_path" != "$hooks_path" ];
	then
		git config --add fizker.hooksPath "$existing_hooks_path"
		git config --unset core.hooksPath
	fi

	popd &> /dev/null
done
